<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#17c0ff">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bedtime Burn</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

<!-- Howler.js (sound) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
<!-- Canvasâ€‘confetti (mini fireworks) -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.1/dist/confetti.browser.min.js"></script>

<style>
:root{
  /* 5 è‰²ãƒ‘ãƒ¬ãƒƒãƒˆ (JS ã§èµ·å‹•æ™‚ã« --accent / --accent-2 ã¸ã‚»ãƒƒãƒˆ) */
  --c0a:#17c0ff; --c0b:#55e0ff;
  --c1a:#ff7ee6; --c1b:#ffb4f6;
  --c2a:#ffb84d; --c2b:#ffd36b;
  --c3a:#00ffa6; --c3b:#5dffcf;
  --c4a:#ffa657; --c4b:#ffce8b;

  --bg-1:#121212;--bg-2:#1c1c1c;
  --accent:var(--c0a);--accent-2:var(--c0b);
  --text:#e4e4e4;--sub:#b0b0b0;
  --shadow:rgba(0,0,0,.6);
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Noto Sans JP',sans-serif;
  background:linear-gradient(var(--bg-1),var(--bg-2));
  color:var(--text);text-align:center;min-height:100vh;
  display:flex;flex-direction:column
}
#header{
  position:fixed;top:0;left:0;right:0;z-index:120;
  padding:10px 0;font-size:1.05em;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  color:#fff;font-family:'Zen Maru Gothic',sans-serif;
  box-shadow:0 2px 4px var(--shadow)
}
#settings{
  position:fixed;top:12px;right:12px;font-size:1.4em;cursor:pointer;z-index:130
}
#content{padding:66px 16px 16px;max-width:480px;margin:0 auto;width:100%}
.screen{
  background:#242424;border-radius:18px;padding:28px 20px;margin-bottom:40px;
  box-shadow:0 4px 8px var(--shadow);display:none;flex-direction:column;align-items:center;
  animation:fade .4s forwards
}
.screen.active{display:flex}
@keyframes fade{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

h1{font-family:'Zen Maru Gothic',sans-serif;font-size:1.9em;margin-bottom:16px;color:var(--accent)}
@keyframes pop{0%{transform:scale(.6);opacity:0}60%{transform:scale(1.15);opacity:1}100%{transform:scale(1)}}
.bounce{animation:pop .5s cubic-bezier(.25,1.5,.5,1)}
p{line-height:1.5;color:var(--sub)}

button{
  font-family:'Zen Maru Gothic',sans-serif;font-size:1.15em;
  padding:12px 28px;margin:10px 6px;border:none;border-radius:34px;
  background:linear-gradient(45deg,var(--accent),var(--accent-2));
  color:#fff;cursor:pointer;position:relative;overflow:hidden;
  box-shadow:0 6px 12px var(--shadow);
  transition:transform .18s,box-shadow .18s
}
button:hover{transform:translateY(-2px);box-shadow:0 8px 16px var(--shadow)}
button:active{transform:scale(.95);box-shadow:0 4px 8px var(--shadow)}
button .ripple{position:absolute;border-radius:50%;transform:scale(0);
  background:rgba(255,255,255,.4);animation:ripple .6s linear}
@keyframes ripple{to{transform:scale(4);opacity:0}}

.spinner{width:68px;height:68px;border:8px solid #333;border-top-color:var(--accent);
  border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 14px;display:none}
@keyframes spin{to{transform:rotate(360deg)}}

#tip{font-size:.95em;margin-bottom:18px;color:var(--accent-2)}
#menu-list{width:100%;max-width:330px}
#menu-list .item{border-bottom:1px solid #444;padding:14px 2px;color:var(--text);opacity:0;animation:up .4s forwards}
@keyframes up{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

#timer-wrap{position:relative;width:220px;height:220px;margin:18px auto}
#timer-wrap svg{display:block}
#time,#phase{
  position:absolute;left:50%;transform:translateX(-50%);text-shadow:0 2px 4px #000
}
#time{top:42%;font-size:2.4em}
#phase{top:60%;font-size:1.05em;color:var(--accent-2)}
#next-phase{top:72%;font-size:.9em;color:var(--sub);opacity:.6;position:absolute;left:50%;transform:translateX(-50%)}
#set-info{font-size:1em;margin-bottom:4px;color:var(--accent)}
#desc{font-size:.9em;margin-top:10px;color:var(--sub);min-height:3.4em}

#timer-circle{
  stroke-dasharray:628; /* 2Ï€r => r=100 */
  stroke-dashoffset:628;
  transition:stroke-dashoffset linear;
  stroke-linecap:round
}
.rest-overlay{
  position:absolute;inset:0;background:rgba(0,0,0,.75);
  display:flex;flex-direction:column;justify-content:center;align-items:center;border-radius:18px
}
.rest-overlay h2{font-family:'Zen Maru Gothic',sans-serif;color:var(--accent);margin-bottom:8px}
.rest-overlay .rest-sec{font-size:2.2em;margin-bottom:14px}

#calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;width:100%;max-width:330px;margin-top:14px}
#calendar div{padding:6px 0;font-size:.8em;background:#3a3a3a;border-radius:4px}
#calendar .marked{background:var(--accent-2);color:#000}
#calendar .today{border:1px solid var(--accent)}

#yt-wrap{position:fixed;bottom:14px;right:14px;width:200px;height:112px;display:none;z-index:110}
#yt-wrap iframe{width:100%;height:100%;border:none;border-radius:12px}
</style>
</head>
<body>

<div id="header">ğŸ”¥ é€£ç¶š <span id="streak">0</span> æ—¥é”æˆ</div>
<div id="settings">ğŸ”Š</div>

<div id="yt-wrap"></div>

<div id="content">
  <!-- Splash -->
  <section id="splash" class="screen active">
    <h1 id="title"></h1>
    <p id="tip"></p>
    <button id="start">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </section>

  <!-- Carnitine -->
  <section id="carn" class="screen">
    <h1>ã‚«ãƒ«ãƒ‹ãƒãƒ³é£²ã‚“ã ï¼Ÿ</h1>
    <button id="c-yes">ã¯ã„</button>
    <button id="c-no">ã„ã„ãˆ</button>
  </section>

  <section id="remind" class="screen">
    <p>é£²ã‚“ã§ã‹ã‚‰å†é–‹ã—ã¦ã­ğŸ˜Œ</p>
    <button id="recheck">ç¢ºèª</button>
  </section>

  <!-- Gacha -->
  <section id="gacha" class="screen">
    <h1>ä»Šæ—¥ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h1>
    <div class="spinner" id="spin-load"></div>
    <div id="menu-list"></div>
    <button id="spin">ã‚¬ãƒãƒ£ã‚’å›ã™</button>
    <button id="go" style="display:none">ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆé–‹å§‹</button>
  </section>

  <!-- Exercise -->
  <section id="work" class="screen">
    <h1 id="ex-name"></h1>
    <p id="set-info"></p>
    <div id="timer-wrap">
      <svg width="220" height="220">
        <circle cx="110" cy="110" r="100" fill="none" stroke="#414141" stroke-width="16"/>
        <circle id="timer-circle" cx="110" cy="110" r="100" fill="none" stroke="var(--accent)" stroke-width="16"/>
      </svg>
      <div id="time">0</div>
      <div id="phase"></div>
      <div id="next-phase"></div>
    </div>
    <p id="desc"></p>
    <button id="done">å®Œäº†</button>
  </section>

  <!-- Stamp -->
  <section id="stamp" class="screen">
    <h1>Good Job!</h1>
    <p>ä»Šæ—¥ã®ã‚¹ã‚¿ãƒ³ãƒ—ğŸ‰</p>
    <div id="calendar"></div>
    <button id="more">ãŠã‹ã‚ã‚Šï¼</button>
    <button id="close">é–‰ã˜ã‚‹</button>
  </section>
</div>

<script>
/* ========= Utility & Storage ========= */
const $ = id => document.getElementById(id);
const screens = ['splash','carn','remind','gacha','work','stamp'].reduce((o,k)=>(o[k]=$(k),o),{});
const show = id => {Object.values(screens).forEach(s=>s.classList.remove('active'));screens[id].classList.add('active');};
document.addEventListener('click', e=>{
  if(e.target.tagName!=='BUTTON') return;
  const b=e.target,s=document.createElement('span');
  s.className='ripple';b.appendChild(s);
  const d=Math.max(b.clientWidth,b.clientHeight);
  s.style.width=s.style.height=d+'px';
  s.style.left=`${e.clientX-b.offsetLeft-d/2}px`;
  s.style.top=`${e.clientY-b.offsetTop-d/2}px`;
  s.addEventListener('animationend',()=>s.remove());
});
const LS='bedBurnData';
const load = () => JSON.parse(localStorage.getItem(LS)||'{"stamps":{},"streak":0,"last":""}');
const save = d => localStorage.setItem(LS,JSON.stringify(d));
const today = () => new Date().toISOString().split('T')[0];
const yesterday = () => {const d=new Date();d.setDate(d.getDate()-1);return d.toISOString().split('T')[0]};

/* ========= Sounds ========= */
const sounds={
  start:new Howl({src:['sounds/start.mp3'],volume:.6}),
  tick :new Howl({src:['sounds/tick.mp3'],volume:.35}),
  done :new Howl({src:['sounds/done.mp3'],volume:.6}),
  praise:new Howl({src:['sounds/praise.mp3'],volume:.55})
};
let mute=false;
$('settings').onclick=()=>{mute=!mute;$('settings').textContent=mute?'ğŸ”‡':'ğŸ”Š'};

/* ========= Static Text ========= */
const tips=[ 'å¯ã‚‹å‰5åˆ†ã§ã‚€ãã¿ã‚ªãƒ•ğŸ¦µ','æ·±å‘¼å¸ã§å‰¯äº¤æ„ŸONğŸ˜Œ','ä»Šæ—¥ã‚‚å°ã•ãªä¸€æ­©ã§OK','åŠ›ã‚’æŠœãã»ã©ç‡ƒãˆã‚‹ğŸ”¥','æ˜æ—¥ã®è‡ªåˆ†ã¸ãŠã¿ã‚„ã’ä»£è¬âœ¨','å‘¼å¸ã¯ã€Œåãã€ã‚’æ„è­˜','è‚©ã®åŠ›ã‚’æŠœã„ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹','ç¶šã‘ã‚‹äººãŒã„ã¡ã°ã‚“å¼·ã„','è„‚è‚ªã‚‚çœ ãŸã„ä»ŠãŒãƒãƒ£ãƒ³ã‚¹','ã‚¹ãƒãƒ›ã¯é¡”ã«è½ã¨ã•ãªã„ã§ã­','å¯è¿”ã‚Šã¤ã„ã§ã«ã‚·ã‚§ã‚¤ãƒ—','å¤œã¯ãƒ’ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚ˆã‚Šã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³','çœ ã‚Šã®æ·±ã•ï¼å›å¾©åŠ›ğŸ’¤','â€œã¡ã‚‡ã„ã‚­ãƒ„â€ ãŒä¸åº¦ã„ã„','ãŸã¨ãˆ1ç¨®ç›®ã§ã‚‚0ã‚ˆã‚Š100å€','ã‚¢ã‚´ã‚’å¼•ãã¨è…¹ç­‹ON','ä»£è¬ã¯è£åˆ‡ã‚‰ãªã„','å¸ƒå›£ã¨å‹é”ã€è„‚è‚ªã¨ã¯ä»–äºº','è‚©ç”²éª¨ã‚’æ„è­˜ã—ã‚ˆã†','ã‚´ãƒ¼ãƒ«ã¯â€œè»½ã„ä½“â€ã®æœ','å¤œã“ãã‚¹ãƒˆãƒ¬ãƒƒãƒåŠ¹ç‡UP','é…’ã‚ˆã‚Šã‚¹ãƒˆãƒ¬ãƒƒãƒã§é…”ãŠã†','ä»Šæ—¥ã®ã‚ãªãŸã¯ã‚¨ãƒ©ã‚¤','å¯ã‚‹å‰ã‚¹ãƒã‚¤ãƒ«ğŸ˜Šã§å¹¸ã›ãƒ›ãƒ«ãƒ¢ãƒ³','ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã¯æœ€å¼·ã®é­”æ³•','æ™‚é–“ã¯æœ€å°‘ã€åŠ¹æœã¯æœ€å¤§','çœ æ°—ãŒæ¥ãŸã‚‰å‹ã¡','å§¿å‹¢ãƒªã‚»ãƒƒãƒˆãŒå¤§äº‹','ãƒªãƒ©ãƒƒã‚¯ã‚¹ï¼ç‡ƒç„¼ãƒ¢ãƒ¼ãƒ‰','Just keep breathing','å‘¼å¸ã«åˆã‚ã›ã¦å‹•ã“ã†','ä»Šæ—¥ã®ç–²ã‚Œã¯ä»Šæ—¥ã®ã†ã¡ã«','è¶³å…ˆãƒã‚«ãƒã‚«ã§å…¥çœ åŠ›UP','æ˜æ—¥ã¯ãã£ã¨è»½ã„ä½“','å¤œã‚¹ãƒˆãƒ¬ãƒƒãƒã§è„‚è‚ªæ’ƒé€€','ã»ã©ã‚ˆã„åˆºæ¿€ã§å¿«çœ ','çœ ã‚‹å‰ã«èº«ä½“ã‚’ãƒªã‚»ãƒƒãƒˆ','è‡ªåˆ†ã¸ã®ãƒŠã‚¤ãƒˆã‚±ã‚¢','å¿ƒåœ°ã‚ˆã„ä¼¸ã³ã§å¹¸ã›','ä»Šæ—¥ã‚‚ Good stretch!' ];
const titles=['ãŠã‚„ã™ã¿ã‚¹ãƒˆãƒ¬ãƒƒãƒ','Bedtime Burn','Moonlight Moves','Dreamy Fit','Pillow Pump','Nightly Flow','Sleepy Shred'];
const bravo=['Nice!','Great!','Perfect!','Good job!','Awesome!','Yatta!','ğŸ‘','âœ¨','ğŸ‘','ğŸ”¥'];

/* ========= Supine Exercise List ========= */
const exList=[
  // éª¨ç›¤ãƒ»ãŠå°»ç³» 8ç¨®
  { key:'pelvic_tilt', name:'éª¨ç›¤å‰å‚¾å¾Œå‚¾', desc:'éª¨ç›¤ã‚’å‰å¾Œã«ã‚†ã£ãã‚Šå‹•ã‹ã—ã¦è…°å›ã‚Šã®ç·Šå¼µã‚’å°‘ã—ãšã¤ã»ãã—ã¦ã„ã', time:60, sets:1,
    phases:[{d:30,t:'å‰å‚¾'},{d:30,t:'å¾Œå‚¾'}]
  },
  { key:'bridge_hold', name:'ãƒ’ãƒƒãƒ—ãƒªãƒ•ãƒˆã‚­ãƒ¼ãƒ—', desc:'ãŠå°»ã‚’ç· ã‚è…°ã‚’é«˜ãä¸Šã’ã¦30ç§’ã‚­ãƒ¼ãƒ—ã—15ç§’ä¸‹ã‚ã—ã¦ä¼‘ã‚€å‹•ä½œã‚’ç¹°ã‚Šè¿”ã™', time:45, sets:2,
    phases:[{d:30,t:'ä¸Šã’ã¦ã‚­ãƒ¼ãƒ—'},{d:15,t:'ä¸‹ã‚ã—ã¦ä¼‘ã‚€'}]
  },
  { key:'single_leg_bridge', name:'ç‰‡è¶³ãƒ’ãƒƒãƒ—ãƒªãƒ•ãƒˆ', desc:'ç‰‡è„šã‚’ä¼¸ã°ã—ã‚‚ã†ç‰‡è„šã§æ”¯ãˆãªãŒã‚‰ãŠå°»ã‚’ä¸Šã’éª¨ç›¤ã‚’å®‰å®šã•ã›ã‚‹', time:60, sets:2,
    phases:[{d:30,t:'å³è„š'},{d:30,t:'å·¦è„š'}]
  },
  { key:'frog_pump', name:'ãƒ•ãƒ­ãƒƒã‚°ãƒãƒ³ãƒ—', desc:'è¶³è£ã‚’åˆã‚ã›è†ã‚’é–‹ã„ãŸã¾ã¾ãŠå°»ã‚’ä¸Šä¸‹ã•ã›ã¦å†…ã‚‚ã‚‚ã¨ãŠå°»ã‚’åˆºæ¿€ã™ã‚‹', time:60, sets:2,
    phases:[{d:60,t:'ãƒ•ãƒ­ãƒƒã‚°ãƒãƒ³ãƒ—'}]
  },
  { key:'glute_bridge_march', name:'ãƒ’ãƒƒãƒ—ãƒªãƒ•ãƒˆãƒãƒ¼ãƒ', desc:'è…°ã‚’ä¸Šã’ãŸå§¿å‹¢ã‚’ä¿ã¡å·¦å³ã®è†ã‚’äº¤äº’ã«å¼•ãä¸Šã’ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’æ•´ãˆã‚‹', time:60, sets:1,
    phases:[{d:60,t:'äº¤äº’ã«è†ä¸Šã’'}]
  },
  { key:'bridge_abduction', name:'ãƒ–ãƒªãƒƒã‚¸ã‚¢ãƒ–ãƒ€ã‚¯ã‚·ãƒ§ãƒ³', desc:'è…°ã‚’æµ®ã‹ã›ãŸã¾ã¾è†ã‚’é–‹é–‰ã—ã¦ãŠå°»ã®æ¨ªå´ã¾ã§ã˜ã£ãã‚Šåˆºæ¿€ã™ã‚‹', time:60, sets:2,
    phases:[{d:30,t:'é–‹ã'},{d:30,t:'é–‰ã˜ã‚‹'}]
  },
  { key:'pelvic_clock', name:'éª¨ç›¤ã‚µãƒ¼ã‚¯ãƒ«', desc:'éª¨ç›¤ã§å††ã‚’æãã‚ˆã†ã«ã‚†ã£ãã‚Šå›ã—è…°å‘¨è¾ºã®ã“ã‚ã°ã‚Šã‚’è§£ãã»ãã™', time:60, sets:1,
    phases:[{d:30,t:'æ™‚è¨ˆå›ã‚Š'},{d:30,t:'åæ™‚è¨ˆ'}]
  },
  { key:'leg_push_pull', name:'è„šæŠ¼ã—å¼•ã', desc:'ç‰‡è†ã‚’èƒ¸ã¸å¼•ãå¯„ã›åå¯¾è¶³ã§è»½ãæŠ¼ã—è¿”ã—ã¦éª¨ç›¤å‘¨ã‚Šã‚’å®‰å®šã•ã›ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'æŠ¼ã—åˆã„'},{d:30,t:'å¼•ãåˆã„'}]
  },

  // è…¹ç­‹ãƒ»ã‚³ã‚¢ç³» 8ç¨®
  { key:'crunch_basic', name:'ã‚¯ãƒ©ãƒ³ãƒ', desc:'ãŠè…¹ã‚’ä¸¸ã‚ã‚‹ã‚ˆã†ã«ä¸Šä½“ã‚’å¼•ãèµ·ã“ã—è…¹ç›´ç­‹ã«ã˜ã‚ã£ã¨åŠ¹ã‹ã›ã‚‹', time:60, sets:2,
    phases:[{d:30,t:'ã‚¢ãƒƒãƒ—'},{d:30,t:'ãƒ€ã‚¦ãƒ³'}]
  },
  { key:'reverse_crunch', name:'ãƒªãƒãƒ¼ã‚¹ã‚¯ãƒ©ãƒ³ãƒ', desc:'è†ã‚’èƒ¸ã«è¿‘ä»˜ã‘ã¦éª¨ç›¤ã‚’æµ®ã‹ã›ã‚†ã£ãã‚Šæˆ»ã™å‹•ãã§ä¸‹è…¹éƒ¨ã‚’é›ãˆã‚‹', time:60, sets:2,
    phases:[{d:30,t:'è†å¼•ãå¯„ã›'},{d:30,t:'ä¼¸ã°ã™'}]
  },
  { key:'cross_crunch', name:'ã‚¯ãƒ­ã‚¹ã‚¯ãƒ©ãƒ³ãƒ', desc:'å³è‚˜ã¨å·¦è†ã€å·¦è‚˜ã¨å³è†ã‚’äº¤äº’ã«å¼•ãå¯„ã›è…¹æ–œç­‹ã‚’åˆºæ¿€ã™ã‚‹', time:60, sets:2,
    phases:[{d:30,t:'å³è‚˜å·¦è†'},{d:30,t:'å·¦è‚˜å³è†'}]
  },
  { key:'toe_tap', name:'ãƒˆãƒ¼ã‚¿ãƒƒãƒ—', desc:'ä¸¡è„šã‚’æŒã¡ä¸Šã’ãŸã¾ã¾åºŠã‚’è»½ãã‚¿ãƒƒãƒ—ã—è…¹ç­‹ã‚’ä¿ã¡ãªãŒã‚‰å‹•ã‹ã™', time:60, sets:1,
    phases:[{d:60,t:'äº¤äº’ã‚¿ãƒƒãƒ—'}]
  },
  { key:'hollow_hold', name:'ãƒ›ãƒ­ãƒ¼ãƒ›ãƒ¼ãƒ«ãƒ‰', desc:'èƒŒä¸­ã‚’åºŠã«ã¤ã‘è…¹ã¨è…°ã‚’æ„è­˜ã—ã¦æ‰‹è¶³ã‚’æµ®ã‹ã›ãŸå§¿å‹¢ã‚’30ç§’ä¿ã¤', time:30, sets:3,
    phases:[{d:30,t:'ãƒ›ãƒ¼ãƒ«ãƒ‰'}]
  },
  { key:'leg_lowering', name:'ãƒ¬ãƒƒã‚°ãƒ­ãƒ¯ãƒªãƒ³ã‚°', desc:'ä¸¡è¶³ã‚’ã‚†ã£ãã‚Šä¸‹ã‚ã—ã¦è…¹åœ§ã‚’ä¿ã¡åå‹•ã‚’ä½¿ã‚ãšã«æˆ»ã—ã¦ã„ã', time:60, sets:2,
    phases:[{d:30,t:'ä¸‹ã‚ã™'},{d:30,t:'æˆ»ã™'}]
  },
  { key:'dead_bug', name:'ãƒ‡ãƒƒãƒ‰ãƒã‚°', desc:'å¯¾è§’ã®æ‰‹è¶³ã‚’ä¼¸ã°ã—ã¦æˆ»ã™å‹•ãã§ä½“å¹¹ã®å®‰å®šæ„Ÿã‚’é«˜ã‚ã‚‹', time:60, sets:2,
    phases:[{d:30,t:'å³æ‰‹å·¦è„š'},{d:30,t:'å·¦æ‰‹å³è„š'}]
  },
  { key:'v_hold', name:'ï¼¶ãƒ›ãƒ¼ãƒ«ãƒ‰', desc:'ä¸¡è„šã¨ä¸Šä½“ã‚’æµ®ã‹ã›ï¼¶å­—ã‚’ä½œã‚Šå‘¼å¸ã‚’ç¶šã‘ãªãŒã‚‰45ç§’ã‚­ãƒ¼ãƒ—ã™ã‚‹', time:45, sets:1,
    phases:[{d:45,t:'ã‚­ãƒ¼ãƒ—'}]
  },

  // ä¸ŠåŠèº«ç³» 6ç¨®
  { key:'chest_opener', name:'èƒ¸ã²ã‚‰ã', desc:'è…•ã‚’æ¨ªã«åºƒã’èƒ¸ã‚’é–‹é–‰ã—ã¦è‚©å‰å´ã®ç·Šå¼µã‚’å’Œã‚‰ã’ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'è…•é–‹ã'},{d:30,t:'è…•é–‰ã˜ã‚‹'}]
  },
  { key:'overhead_reach', name:'äº¤äº’ãƒãƒ³ã‚¶ã‚¤', desc:'ä¸¡æ‰‹ã‚’äº¤äº’ã«é ­ä¸Šã¸ä¼¸ã°ã—è‚©å‘¨ã‚Šã®å¯å‹•åŸŸã‚’ã‚†ã£ãã‚Šåºƒã’ã¦ã„ã', time:60, sets:1,
    phases:[{d:60,t:'äº¤äº’ã«ä¼¸ã°ã™'}]
  },
  { key:'elbow_press', name:'ã‚¨ãƒ«ãƒœãƒ¼ãƒ—ãƒ¬ã‚¹', desc:'è‚˜ã‚’åºŠã¸æŠ¼ã—ã¤ã‘èƒ¸ã‚’å¼µã‚ŠãªãŒã‚‰è…•ã‚’æ›²ã’ä¼¸ã°ã—ã—ã¦ä¸Šè…•ã‚’åˆºæ¿€', time:60, sets:1,
    phases:[{d:30,t:'è‚˜æ›²ã’'},{d:30,t:'è‚˜ä¼¸ã°ã—'}]
  },
  { key:'wrist_flex', name:'æ‰‹é¦–åã‚‰ã—æ›²ã’', desc:'æ‰‹é¦–ã‚’ã‚†ã£ãã‚Šåã‚‰ã›ãŸå¾Œã«æ›²ã’ã‚‹å‹•ä½œã§å‰è…•ã®å¼µã‚Šã‚’å’Œã‚‰ã’ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'åã‚‰ã™'},{d:30,t:'æ›²ã’ã‚‹'}]
  },
  { key:'finger_tap', name:'ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ã‚¿ãƒƒãƒ—', desc:'æŒ‡å…ˆã‚’ãƒªã‚ºãƒŸã‚«ãƒ«ã«ã‚¿ãƒƒãƒ—ã—æ‰‹ã®è¡€æµã‚’ä¿ƒã—ã¦è‚©ã“ã‚Šäºˆé˜²ã‚’å›³ã‚‹', time:30, sets:2,
    phases:[{d:30,t:'ãƒ‘ãƒ©ãƒ‘ãƒ©ã‚¿ãƒƒãƒ—'}]
  },
  { key:'ceiling_punch', name:'å¤©äº•ãƒ‘ãƒ³ãƒ', desc:'æ‹³ã‚’å¤©äº•ã«çªãä¸Šã’ã‚‹å‹•ä½œã‚’ç¹°ã‚Šè¿”ã—è‚©ç”²éª¨ã¨è…•ã‚’æ»‘ã‚‰ã‹ã«å‹•ã‹ã™', time:60, sets:1,
    phases:[{d:60,t:'ã‚†ã£ãã‚Šçªãä¸Šã’'}]
  },

  // ãã®ä»–å…¨èº«ãƒ»è»½ã‚å‹•ä½œ 8ç¨®
  { key:'ankle_flex', name:'è¶³é¦–ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹', desc:'ã¤ã¾å…ˆã‚’ä¼¸ã°ã—ãŸã‚Šã‹ã‹ã¨ã‚’æŠ¼ã—å‡ºã—ãŸã‚Šã—ã¦è¶³é¦–å‘¨ã‚Šã‚’ã»ãã™', time:60, sets:1,
    phases:[{d:30,t:'ã¤ã¾å…ˆä¼¸ã°ã™'},{d:30,t:'ã‹ã‹ã¨æŠ¼ã—å‡ºã™'}]
  },
  { key:'knee_open_close', name:'è†é–‹é–‰', desc:'ä¸¡è†ã‚’ç«‹ã¦ãŸã¾ã¾é–‹ã„ã¦é–‰ã˜ã‚‹å‹•ä½œã§è‚¡é–¢ç¯€ã‚’ã‚†ã£ãã‚Šæ¸©ã‚ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'é–‹ã'},{d:30,t:'é–‰ã˜ã‚‹'}]
  },
  { key:'lying_starfish', name:'ã‚¹ã‚¿ãƒ¼ãƒ•ã‚£ãƒƒã‚·ãƒ¥', desc:'æ‰‹è¶³ã‚’æ˜Ÿå½¢ã«é–‹é–‰ã—å…¨èº«ã‚’å¿ƒåœ°ã‚ˆãä¼¸ã°ã—ã¦è¡€è¡Œã‚’ä¿ƒé€²ã™ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'é–‹ã'},{d:30,t:'é–‰ã˜ã‚‹'}]
  },
  { key:'supine_twist', name:'ã‚†ã‚‹ãƒ„ã‚¤ã‚¹ãƒˆ', desc:'ä¸¡è†ã‚’æƒãˆå·¦å³ã¸å€’ã—ä½“å¹¹ã‚’ã­ã˜ã£ã¦èƒŒä¸­ã‹ã‚‰è…°ã‚’ã‚†ã£ãã‚Šç·©ã‚ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'å³å€’ã—'},{d:30,t:'å·¦å€’ã—'}]
  },
  { key:'tiptoe_reach', name:'ã¤ã¾å…ˆãƒªãƒ¼ãƒ', desc:'è¶³å…ˆã‚’é ãã¸ä¼¸ã°ã™æ„è­˜ã§èƒŒä¼¸ã³ã‚’ã—ä½“ã®æœ«ç«¯ã¾ã§æ°—æŒã¡ã‚ˆãä¼¸ã°ã™', time:60, sets:1,
    phases:[{d:30,t:'ã¤ã¾å…ˆä¼¸ã°ã™'},{d:30,t:'æ¥½ã«æˆ»ã™'}]
  },
  { key:'knee_drop', name:'ãƒ‹ãƒ¼ã‚µã‚¤ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—', desc:'è†ã‚’90åº¦ã«æ›²ã’ãŸã¾ã¾å·¦å³ã¸è½ã¨ã—ã¦è…¹æ–œç­‹ã¨è…°ã‚’å„ªã—ãåˆºæ¿€ã™ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'å³è½ã¨ã™'},{d:30,t:'å·¦è½ã¨ã™'}]
  },
  { key:'humming_breath', name:'ãƒãƒŸãƒ³ã‚°å‘¼å¸', desc:'é¼»ã‹ã‚‰å¸ã„ãªãŒã‚‰å£ã‚’é–‰ã˜ãƒãƒŸãƒ³ã‚°ã§åãåˆ‡ã‚Šå‰¯äº¤æ„Ÿç¥çµŒã‚’é«˜ã‚ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'é¼»ã‹ã‚‰å¸ã†'},{d:30,t:'ãƒãƒŸãƒ³ã‚°åã'}]
  },
  { key:'lying_march', name:'å¯ãŸã¾ã¾ãƒãƒ¼ãƒ', desc:'ä¸¡è†ã‚’äº¤äº’ã«å¼•ãä¸Šã’ã‚‹ã‚†ã£ãã‚Šã—ãŸè¶³è¸ã¿ã§å…¨èº«ã®è¡€æµã‚’ä¿ƒã™', time:60, sets:2,
    phases:[{d:60,t:'ã‚†ã£ãã‚Šè¶³è¸ã¿'}]
  },

  // ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãƒ»ã‚¹ãƒˆãƒ¬ãƒƒãƒ 5ç¨®
  { key:'supine_hug', name:'å…¨èº«ãƒã‚°ã‚¹ãƒˆãƒ¬ãƒƒãƒ', desc:'ä¸¡è†ã‚’æŠ±ãˆè¾¼ã¿èƒŒä¸­ã‚’ä¸¸ã‚ã¦å‘¼å¸ã‚’æ·±ã‚å…¨èº«ã®åŠ›ã‚’æŠœã„ã¦ã„ã', time:60, sets:1,
    phases:[{d:30,t:'æŠ±ãˆè¾¼ã‚€'},{d:30,t:'ãƒªãƒ©ãƒƒã‚¯ã‚¹'}], cooldown:true
  },
  { key:'hamstring_stretch', name:'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ä¼¸ã°ã—', desc:'ç‰‡è„šãšã¤è†ã‚’ä¼¸ã°ã—ã¦å¤ªã‚‚ã‚‚è£ã‚’å¿ƒåœ°ã‚ˆãä¼¸ã°ã—ã‚†ã£ãã‚Šå‘¼å¸ã™ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'å³è„šä¼¸ã°ã™'},{d:30,t:'å·¦è„šä¼¸ã°ã™'}], cooldown:true
  },
  { key:'spinal_twist_hold', name:'ãƒ„ã‚¤ã‚¹ãƒˆãƒ›ãƒ¼ãƒ«ãƒ‰', desc:'ç‰‡è†ã‚’åå¯¾å´ã¸å€’ã—ä¸ŠåŠèº«ã¯é€†ã«å‘ã‘ã¦èƒŒéª¨ã®ä¼¸ã³ã‚’æ„Ÿã˜ãªãŒã‚‰ä¿ã¤', time:60, sets:1,
    phases:[{d:30,t:'å³ã¸å€’ã™'},{d:30,t:'å·¦ã¸å€’ã™'}], cooldown:true
  },
  { key:'deep_breath', name:'ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ–ãƒ¬ã‚¹', desc:'é¼»ã‹ã‚‰ã‚†ã£ãã‚Šå¸ã„å£ã‹ã‚‰é•·ãåãæ·±ã„å‘¼å¸ã§å¿ƒèº«ã‚’è½ã¡ç€ã‹ã›ã‚‹', time:60, sets:1,
    phases:[{d:30,t:'é¼»ã‹ã‚‰å¸ã†'},{d:30,t:'å£ã‹ã‚‰åã'}], cooldown:true
  },
  { key:'body_scan', name:'ãƒœãƒ‡ã‚£ã‚¹ã‚­ãƒ£ãƒ³', desc:'é ­ã‹ã‚‰è¶³å…ˆã¸æ„è­˜ã‚’å‘ã‘é †ç•ªã«è„±åŠ›ã—å¿ƒåœ°ã‚ˆã„çœ ã‚Šã¸å°ã„ã¦ã„ã', time:90, sets:1,
    phases:[{d:90,t:'é †ã«è„±åŠ›'}], cooldown:true
  }
];

/* ========= Accent randomiser ========= */
const accents=[['var(--c0a)','var(--c0b)'],['var(--c1a)','var(--c1b)'],['var(--c2a)','var(--c2b)'],['var(--c3a)','var(--c3b)'],['var(--c4a)','var(--c4b)']];
function setAccent(){
  const pair=accents[Math.random()*accents.length|0];
  document.documentElement.style.setProperty('--accent',pair[0]);
  document.documentElement.style.setProperty('--accent-2',pair[1]);
}

/* ========= Runtime State ========= */
let routine=[],ci=0,cs=1,sec=0,ph=0,phLeft=0,timer,resting=false;

/* ========= Init ========= */
document.addEventListener('DOMContentLoaded',()=>{
  setAccent();
  $('title').textContent=titles[Math.random()*titles.length|0];
  $('tip').textContent=tips[Math.random()*tips.length|0];
  const d=load();$('streak').textContent=d.streak;
});

/* ========= Flow Buttons ========= */
$('start').onclick=()=>show('carn');
$('c-yes').onclick=()=>show('gacha');
$('c-no').onclick=()=>show('remind');
$('recheck').onclick=()=>show('carn');

$('spin').onclick=()=>{
  $('spin-load').style.display='block';
  $('spin').disabled=true;
  setTimeout(()=>{ $('spin-load').style.display='none'; makeRoutine(); $('spin').disabled=false; },1300);
};
$('go').onclick=()=>{ci=0;cs=1;startEx()};

function makeRoutine(){
  const normal=exList.filter(e=>!e.cooldown);
  const cool=exList.filter(e=>e.cooldown);
  normal.sort(()=>Math.random()-0.5);
  routine=[]; // å®‰å…¨ã®ãŸã‚ãƒªã‚»ãƒƒãƒˆ
  routine.push(...normal.slice(0,3));
  routine.push(cool[Math.random()*cool.length|0]);
  const list=$('menu-list');list.innerHTML='';
  routine.forEach((ex,i)=>{
    const div=document.createElement('div');
    div.className='item';div.style.animationDelay=`${i*.08}s`;
    div.textContent=`${ex.name}ï¼ˆ${ex.sets} setï¼‰`;
    list.appendChild(div);
  });
  $('spin').style.display='none';$('go').style.display='inline-block';
}

/* ========= Exercise Engine ========= */
function startEx(){
  show('work');resting=false;
  const ex=routine[ci];
  $('ex-name').classList.remove('bounce');void $('ex-name').offsetWidth;$('ex-name').textContent=ex.name;$('ex-name').classList.add('bounce');
  $('set-info').textContent=`${cs}/${ex.sets} ã‚»ãƒƒãƒˆ`;
  $('desc').textContent=ex.desc;
  $('phase').textContent=ex.phases[0].t;
  function updateNext(){
    if(ex.phases.length>1 && sec>phLeft){
      const np=ex.phases[(ph+1)%ex.phases.length];
      $('next-phase').style.display='block';
      $('next-phase').textContent=`æ¬¡: ${np.t} (${np.d}s)`;
    }else{
      $('next-phase').style.display='none';
    }
  }
  sec=ex.time;ph=0;phLeft=ex.phases[0].d;
  updateNext();
  $('time').textContent=sec;
  const circle=$('timer-circle');
  circle.style.transition='none';circle.style.strokeDashoffset=628;void circle.getBoundingClientRect();
  circle.style.transition=`stroke-dashoffset ${ex.time}s linear`;
  circle.style.strokeDashoffset=0;
  if(!mute)sounds.start.play();
  clearInterval(timer);
  timer=setInterval(()=>{
    if(resting) return;
    sec--;phLeft--;
    if(!mute)sounds.tick.play();
    if(phLeft<=0){
      ph=(ph+1)%ex.phases.length;
      phLeft=ex.phases[ph].d;
      $('phase').textContent=ex.phases[ph].t;
    }
    updateNext();
    $('time').textContent=sec;
    if(sec<=0) clearInterval(timer);
  },1000);
}

/* --- Done button --- */
$('done').onclick=()=>{
  if(resting) return;
  if(!mute){sounds.done.play();sounds.praise.play();}
  confetti({particleCount:80,spread:70,origin:{y:.6}});
  const ex=routine[ci];
  if(cs<ex.sets){cs++;restPhase();}
  else{
    ci++;cs=1;
    if(ci<routine.length) restPhase();
    else finish();
  }
};

/* --- Rest Phase 10 s --- */
function restPhase(){
  resting=true;
  const ov=document.createElement('div');
  ov.className='rest-overlay';
  ov.innerHTML=`<h2>${bravo[Math.random()*bravo.length|0]}</h2><div class="rest-sec" id="r-sec">10</div><button id="next">æ¬¡ã¸</button>`;
  $('timer-wrap').appendChild(ov);
  let r=10;
  const rT=setInterval(()=>{
    r--;$('r-sec').textContent=r;
    if(r<=0) go();
  },1000);
  function go(){clearInterval(rT);ov.remove();resting=false;startEx();}
  $('next').onclick=go;
}

/* --- Finish routine --- */
function finish(){
  const d=load(),k=today();
  const prev = typeof d.stamps[k]==='number' ? d.stamps[k] : (d.stamps[k] ? 1 : 0);
  if(prev===0){
    d.streak = d.last===yesterday()?d.streak+1:1;
    d.last=k;
  }
  d.stamps[k]=prev+1;
  save(d);
  $('streak').textContent=d.streak;
  buildCal(d.stamps);
  show('stamp');
}
/* calendar */
function buildCal(st){
  const cal=$('calendar');cal.innerHTML='';
  ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(d=>{
    const h=document.createElement('div');h.textContent=d;h.style.background='#555';cal.appendChild(h);
  });
  const n=new Date(),y=n.getFullYear(),m=n.getMonth();
  const first=new Date(y,m,1).getDay(),days=new Date(y,m+1,0).getDate();
  for(let i=0;i<first;i++) cal.appendChild(document.createElement('div'));
  for(let d=1;d<=days;d++){
    const cell=document.createElement('div');
    const key=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const cnt = typeof st[key]==='number' ? st[key] : (st[key] ? 1 : 0);
    cell.textContent = cnt>1 ? `ğŸ”¥Ã—${cnt}` : d;
    if(cnt) cell.classList.add('marked');
    if(key===today()) cell.classList.add('today');
    cal.appendChild(cell);
  }
}
$('close').onclick=()=>{show('splash');$('tip').textContent=tips[Math.random()*tips.length|0];setAccent();};
$('more').onclick=()=>{makeRoutine();show('gacha');};

/* ========= Free YouTube PiP (longâ€‘press) ========= */
let pressT;
$('settings').addEventListener('mousedown',()=>pressT=setTimeout(longPress,800));
$('settings').addEventListener('mouseup',()=>clearTimeout(pressT));
function longPress(){
  const url=prompt('YouTube URL / ID?','');
  if(!url) return;
  $('yt-wrap').innerHTML=`<iframe src="https://www.youtube.com/embed/${ytID(url)}?autoplay=1&mute=1&controls=0&rel=0" allow="autoplay;picture-in-picture" allowfullscreen></iframe>`;
  $('yt-wrap').style.display='block';
}
const ytID = u => u.includes('youtu') ? u.split(/v=|be\//)[1].substring(0,11) : u;
</script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}
</script>

</body>
</html>
